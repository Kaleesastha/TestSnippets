<html><head><title>Oracle-RAC-in-Oracle-VM</title><link href="/_zoho/styles/default.css" rel="stylesheet" type="text/css" rev="1.0"></head><body style="margin:20px"><h1 id="pageheader" class="pageheader">Oracle RAC in Oracle VM</h1><br /><div><b><u><font class="Apple-style-span" size="2">Setting up ORACLE RAC in ORACLE VM</font></u></b></div><div><b><font class="Apple-style-span" size="2"><br /></font></b></div><div><u><b>Software required :</b></u></div><div>1. Download ovm server and manager from oracle vm site.</div><div>2. Download OVM 11g RAC template from oracle vm site.</div><div>Ref : <a href="http://www.oracle.com/us/technologies/virtualization/oraclevm/index.html">http://www.oracle.com/us/technologies/virtualization/oraclevm/index.html</a></div><div><br /></div><div><u><b>Installation :</b></u></div><div>1. First install OVM server using a boot up disc. Ensure you have atleast  40GB to 60 GB space before installation.</div><div>2. Install the rpm for vnc etc. <br />3. After installing OVM server, boot up the same and install OVM Manager (This is the interface for managing the vm servers)</div><div>4. Extract the RAC template to the machine and add the same to the VM manager.</div><div>5. From OVM Manager, install the rac template and configure the same.</div><div><b>// The details of installation can be found in the readme files of the ovm server, manager  and rac template</b></div><div><br /></div><div><u><b>For configuring RAC setup</b></u></div><div><br /></div><div>1. Add 5 shared disks of 2GB space in the VM manager.</div><div>2. Create 2 virtual servers(racnode1 &amp; racnode2) using the template (give separate interface address for eth0 and eth1)</div><div>3. Associate shared disks with the racnodes &amp; start the same.</div><div>4. Connect to both nodes using vpn (ip:5900 &amp; ip:5901) and complete the interview process.</div><div>5. Provide valid ip details. The public ip, vip &amp; scan ip should be in the same n/w. No need of dns name.</div><div>6. After it boots up, login to the primary node i.e racnode1 and go to the folder /u01/racovm. Modify the file param.ini to set the correct password for the machines (sankho) and to enable db console.</div><div>7. run ./buildcluster.sh (takes 1hr)</div><div>Ref : <a href="http://www.oracle.com/technetwork/database/clustering/overview/rac11201-ovm-tmplt-test-config-170446.pdf" target="_blank" title="http://www.oracle.com/technetwork/database/clustering/overview/rac11201-ovm-tmplt-test-config-170446.pdf">http://www.oracle.com/technetwork/database/clustering/overview/rac11201-ovm-tmplt-test-config-170446.pdf</a></div><div><br /></div><div><u>How to add new user name to RAC.</u></div><div>1. connect to racnode1 using conn system/oracle@racnode1:1521/ORCL/ORCL1<br />2. use the standard procedure for creating users and granting permissions</div><div><br /></div><div><u>Setting up EM manager</u></div><div>By default, the EM managers  would be started in both the nodes.<br />Check if it running by executing the following command in &lt;ORACLE_HOME&gt;/bin</div><div>./emctl status dbconsole</div><div><br /></div><div>If it is not up use the following to start it :</div><div>./emctl start dbconsole</div><div><br /></div><div><u><br /></u></div><div><u><b><font class="Apple-style-span" size="2">Connecting to Oracle RAC</font></b></u></div><div>1. Using the virtual IPs:</div><div>jdbc:oracle:thin:@(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = <b>192.168.108.110</b>)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = <b>192.168.108.120</b>)(PORT = 1521))(LOAD_BALANCE = yes)(FAILOVER = ON))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME =ORCL)))</div><div><br /></div><div>2. Using SCAN : In SCAN, you do not need to enter all the virtual ips of the rac nodes, the commoin vip is enough. </div><div>jdbc:oracle:thin:@(DESCRIPTION =  (ADDRESS_LIST =  (ADDRESS =  (PROTOCOL = tcp)(HOST = <b>192.168.108.252</b>) (PORT = 1521)) ) (CONNECT_DATA = (SERVICE_NAME = ORCL) ) )</div><div><br /></div><div>When using SCAN, ensure that the racnode hostname mapping is provided in the /etc/hosts file. This is because when using SCAN ip, it internally used the the hostname of the racnodes to create connections.</div><div>Ex :</div><div><div>192.168.108.110 racnode1-vip.localdomain racnode1-vip</div><div>192.168.108.120 racnode2-vip.localdomain racnode2-vip</div></div><div><br /></div><div><br /></div><div><u><b><font class="Apple-style-span" size="2">Configuring parameters of RAC</font></b></u></div><div><span class="Apple-style-span" style="line-height: 23px; "><font class="Apple-style-span" size="1">1. Server side configuration</font></span></div><div><ul><li><font class="Apple-style-span" size="1"><span class="Apple-style-span" style="line-height: 23px; ">There are 2 types of timeout to detect the node failure, namely disk i/o timeout and network timeout. However it is not recommended to change the default settings</span></font></li><li><font class="Apple-style-span" size="1"><span class="Apple-style-span" style="line-height: 23px; ">Ref : </span></font><a href="http://prodlife.wordpress.com/2009/02/24/modifying-rac-parameters/">http://prodlife.wordpress.com/2009/02/24/modifying-rac-parameters/</a></li></ul></div><div><span class="Apple-style-span" style="line-height: 23px; "><font class="Apple-style-span" size="1"><br /></font></span></div><div><span class="Apple-style-span" style="line-height: 23px; "><font class="Apple-style-span" size="1">2. Client side configuration.</font></span></div><div><ul><li><font class="Apple-style-span" size="1"><span class="Apple-style-span" style="line-height: 23px; ">These configuration are mainly for the driver specific parameters like in TCF parameters in OCI driver</span></font></li><li><font class="Apple-style-span" size="1"><span class="Apple-style-span" style="line-height: 23px; ">Sample config : (FAILOVER_MODE =(<b>TYPE</b> = SELECT)(<b>METHOD </b>= BASIC)(<b>RETRIES</b> = 10)(<b>DELAY</b> = 5)))</span></font></li><li><font class="Apple-style-span" size="1"><span class="Apple-style-span" style="line-height: 23px; ">Ref : </span></font><a href="http://easyoradba.wordpress.com/2011/01/13/transparent-application-failover-taf-in-oracle/">http://easyoradba.wordpress.com/2011/01/13/transparent-application-failover-taf-in-oracle/</a></li></ul></div><div><br /></div><div><br /><span style="font-weight: bold; text-decoration: underline; "><font class="Apple-style-span" size="2">Failover in Oracle RAC</font></span><br />1. When a racnode is down, its virtual ip gets re-assigned to any of the other racnodes. Hence application can still be connected to all DB. But this is a hard transition and needs our db reconnection to be true. In such a case, our framework closes all the existing connection (including the proper ones) and recreate them.<br />2. Non Application failover provision :   TAF (Transparent Application Failover) and FCF (Fast Connection failover)<br /><br /><span style="font-weight: bold; ">1. TAF (Transparent Application Failover)</span><br /><ul><li>This type failover happens at oracle driver level. Applications need not take care of handling racnode failures.<br /></li><li>The connections would be automatically routed to the new racnode.</li><li>Currently only SELECT query works seamlessly i.e the proper results would be fetched during failover. UPDATE and INSERT queries would fail and then the connection would be rerouted to the new racnode</li><li style="background-color: rgb(255, 255, 255); color: rgb(255, 0, 0); ">LIMITATION : It only works in OC1 driver and hence need to test in Webnms. So far not tested in Webnms 5.<br /></li><li><span style="background-color: rgb(255, 102, 102); "><span style="background-color: rgb(255, 255, 255); ">Ref for config : </span></span><a href="http://easyoradba.wordpress.com/2011/01/13/transparent-application-failover-taf-in-oracle/">http://easyoradba.wordpress.com/2011/01/13/transparent-application-failover-taf-in-oracle/</a><span style="background-color: rgb(255, 102, 102); "><span style="background-color: rgb(255, 255, 255); ">&nbsp;</span></span></li></ul></div><div><span style="font-weight: bold; ">2. FCF (Fast Connection failover)</span><br /><ul><li>This is independent of driver.</li><li>It relies on ONS ( Oracle notification service - an observer service that propagates db events)</li><li>Need to create PoolDatasource object and configure FCF params. And then fetch connections from it.</li><li>Need to include ons.jar from oracle client software.</li><li><font class="Apple-style-span" color="#ff0000">LIMITATION : As hibernate creates the connections for us, not sure how to replace it with the ones created with FCF.</font></li><li>Ref : <a href="http://download.oracle.com/docs/cd/B28359_01/java.111/e10788/rac.htm">http://download.oracle.com/docs/cd/B28359_01/java.111/e10788/rac.htm</a></li><li>Ref : <a href="http://drdobbs.com/java/222700353?pgno=2">http://drdobbs.com/java/222700353?pgno=2</a></li><li>Ref : <a href="http://download.oracle.com/docs/cd/B19306_01/java.102/b14355/fstconfo.htm">http://download.oracle.com/docs/cd/B19306_01/java.102/b14355/fstconfo.htm</a></li></ul><br /></div><div><span style="font-weight: bold; text-decoration: underline; "><font class="Apple-style-span" size="2">Load balancing in Oracle RAC</font></span><br />1. Client side load balancing - this is a random fetch of connections from one of the configured rac nodes.</div><div>2. Server side load balancing - this can configured based on cpu usage etc.</div><div>Ref : <a href="http://www.databasejournal.com/features/oracle/article.php/3666396/Oracle-10gR2-RAC-Load-Balancing-Features.htm">http://www.databasejournal.com/features/oracle/article.php/3666396/Oracle-10gR2-RAC-Load-Balancing-Features.htm</a></div><div><br /></div><div><b>1. Client side load balancing</b></div><div><ul><li>Random fetch of connections from any of the racnodes (not round robin)</li><li>It is enabled by including LOAD_BALANCE = yes/on/true in the jdbc url</li><li>If server side load balancing is enabled, client side load balancing would be disabled.</li></ul></div><div><br /></div><div><b>2. Server side load balancing</b></div><div><ul><li>By default, the connections are assigned based on the cpu load on each nodes.</li><li>There are listeners registered with each node and they communicate with each other about the node status.</li><li>It uses oracle ons (oracle notification service)</li><li>From 11g rel 2, SCAN does load balancing in oracle rac.</li><li>There is provision to customize load balancing. <font class="Apple-style-span" color="#ff0000">Need to analyze </font></li></ul></div><div><br /></div><div><b><u><font class="Apple-style-span" size="2">Separating tables into different disks in SAN</font></u></b></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><div><u><b>Troubleshooting</b></u></div><div>1. In case the manager is not starting in racnode2, check if the emd.properties file is same as the one in racnode1. ( file is in ORACLE_HOME/racnode2_.ORCL/sysman/config. change repository_url to racnode2 &amp; enable omsRecvDir)</div><div>2. ovs manger operations : /sbin/service oc4j start/stop</div><div>3. ovs agent operations : /sbin/service ovs-agent start/status/stop</div><div>4. log files : /var/log/ovs-agent/ &amp; /var/log/ovm-manager</div></div><div><br /></div><div><br /></div><div><br /></div><div><b>Other Ref : </b></div><div><a href="http://gjilevski.wordpress.com/2011/02/11/oracle-virtualization-installing-oracle-vm-server-2-2-1-oracle-vm-manager-2-2-0-and-deploying-oracle-rac-11gr2-11-2-0-2-oracle-vm-templates-linux-x86-64-bit-for-test-configuration/">http://gjilevski.wordpress.com/2011/02/11/oracle-virtualization-installing-oracle-vm-server-2-2-1-oracle-vm-manager-2-2-0-and-deploying-oracle-rac-11gr2-11-2-0-2-oracle-vm-templates-linux-x86-64-bit-for-test-configuration/</a></div><div><a href="http://www.oracle.com/technetwork/database/clustering/overview/twp-rac11gr2-134105.pdf">http://www.oracle.com/technetwork/database/clustering/overview/twp-rac11gr2-134105.pdf</a></div><div><br /></div><div><br /></div></body></html>